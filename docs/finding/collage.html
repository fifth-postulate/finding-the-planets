<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Collage - Finding the Planets</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A book accompanying a workshop to find the planets around Trappist-1.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        
        <!-- MathJax -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme;
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            document.querySelector('html').classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="title.html">Finding The Planets</a></li><li class="affix"><a href="about.html">What is this book about</a></li><li><a href="background.html"><strong aria-hidden="true">1.</strong> Background</a></li><li><ol class="section"><li><a href="background/trappist-1.html"><strong aria-hidden="true">1.1.</strong> Trappist-1</a></li><li><a href="background/kepler.html"><strong aria-hidden="true">1.2.</strong> Kepler Spacecraft</a></li></ol></li><li><a href="science.html"><strong aria-hidden="true">2.</strong> Science</a></li><li><ol class="section"><li><a href="science/discovery.html"><strong aria-hidden="true">2.1.</strong> Exo-planet Discovery</a></li><li><a href="science/position.html"><strong aria-hidden="true">2.2.</strong> Observing Position</a></li><li><a href="science/doppler.html"><strong aria-hidden="true">2.3.</strong> Doppler Effect</a></li></ol></li><li><a href="transit.html"><strong aria-hidden="true">3.</strong> Transit Method</a></li><li><ol class="section"><li><a href="transit/light_curve.html"><strong aria-hidden="true">3.1.</strong> What To Look For</a></li></ol></li><li><a href="finding.html"><strong aria-hidden="true">4.</strong> Finding Planets</a></li><li><ol class="section"><li><a href="finding/fits.html"><strong aria-hidden="true">4.1.</strong> FITS</a></li><li><a href="finding/csv.html"><strong aria-hidden="true">4.2.</strong> CSV</a></li><li><a href="finding/image.html"><strong aria-hidden="true">4.3.</strong> Image</a></li><li><a href="finding/collage.html" class="active"><strong aria-hidden="true">4.4.</strong> Collage</a></li><li><a href="finding/brightness.html"><strong aria-hidden="true">4.5.</strong> Brightness</a></li><li><a href="finding/detrend.html"><strong aria-hidden="true">4.6.</strong> Detrend</a></li><li><a href="finding/filter.html"><strong aria-hidden="true">4.7.</strong> Filter</a></li><li><a href="finding/median.html"><strong aria-hidden="true">4.8.</strong> Median</a></li><li><a href="finding/fitting.html"><strong aria-hidden="true">4.9.</strong> Fitting</a></li></ol></li><li><a href="reflection.html"><strong aria-hidden="true">5.</strong> Reflection</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="submenu">
                                <li><button class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li><button class="theme" id="rust">Rust</button></li>
                                <li><button class="theme" id="coal">Coal</button></li>
                                <li><button class="theme" id="navy">Navy</button></li>
                                <li><button class="theme" id="ayu">Ayu</button></li>
                            </ul>
                        </div>

                        <h1 class="menu-title">Finding the Planets</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="finding/collage.html#collage" id="collage"><h1>Collage</h1></a>
<p>In this chapter we will create a Collage of all the image in the long cadence
file. Although it is a bit of a side-track, we will learn valuable things by
looking at the image.</p>
<p>If you want, you can take a <a href="image/collage.png">sneak peek</a>.</p>
<p>We will not go into details of reading the data and writing the transformed
data. We assume that the previous chapters have given enough examples to learn
from. Instead we are going to focus on processing the data.</p>
<a class="header" href="finding/collage.html#processing" id="processing"><h2>Processing</h2></a>
<p>There are a few questions we need to answer before we can create our collage.</p>
<ol>
<li>For a row of data and a column in that row, which pixel should we paint?</li>
<li>What color should we paint that pixel?</li>
</ol>
<a class="header" href="finding/collage.html#position" id="position"><h3>Position</h3></a>
<p>When we created the single image, we did not have to think about positioning
explicitly. Because we want to make a collage we have some work to do.</p>
<p>First of all, lets state some facts.</p>
<ol>
<li>Each image is 11x11 pixels.</li>
<li>There are 3599 rows of images.</li>
</ol>
<p>The interesting thing about 3599 is that is 61x59. So we could make our collage
almost a square with 61 columns and 59 rows of single images. With 11x11 images
as base our collage will come in at 61x11 = 671 by 59x11 = 649.</p>
<p>Let's start by giving names to things. We start out with the tile base size,
i.e. the size of the original image. We are going to call that <code>BASE</code>. Next we
want 61 of our tiles to go horizontally, and we want 59 of our tiles to go
vertically. We will call these <code>HORIZONTAL_TILES</code> and <code>VERTICAL_TILES</code>
respectively.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
const BASE: usize = 11;
const HORIZONTAL_TILES: usize = 61;
const VERTICAL_TILES: usize = 59;
#}</code></pre></pre>
<p>Now we can express all the other dimensions in terms of our <code>BASE</code> and
<code>HORIZONTAL_TILES</code> and <code>VERTICAL_TILES</code>.</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
const WIDTH: usize = HORIZONTAL_TILES * BASE;
const HEIGHT: usize = VERTICAL_TILES * BASE;
const SIZE: usize = WIDTH * HEIGHT;
#}</code></pre></pre>
<p>For example, <code>SIZE</code> is the number of pixels in our base tile. Let's continue and
figure out where the pixels go. There are two factors that determine the
position of the pixel. The which row that data is from, and which column the
data is in.</p>
<p>We will start with the row. Because we have 61 images along the x-axis of our
collage, the <code>X</code>-offset will be</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let offset_X = row_index % HORIZONTAL_TILES;
#}</code></pre></pre>
<p>The <code>Iter</code> trait has a very nice method:
<a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.enumerate"><code>enumerate</code></a>.
What it does is besides iterating over the <code>row</code>, it also provides us with the
<code>row_index</code>. We should keep this in mind when we are putting things together.</p>
<p>After <code>HORIZONAL_TILES</code> rows, we need to increase the <code>Y</code>-offset with one. This amounts to</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let offset_Y = row_index / HORIZONTAL_TILES;
#}</code></pre></pre>
<p>Now for the offset within the image. The image is <code>BASE</code>x<code>BASE</code>. So given an original
index in the row, we have for the</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let offset_x = original_index % BASE;
let offset_y = original_index / BASE;
#}</code></pre></pre>
<p>Now we can calculate the target index. For each <code>offset_Y</code> we need to go down an
entire <code>BASE</code> rows in our collage. This is <code>BASE</code>x<code>HORIZONTAL_TILES</code>x<code>BASE</code> (=
7381). For each <code>offset_X</code> we need to shift <code>BASE</code> pixels down. For each
<code>offset_y</code> we need to go down an entire row. This is <code>HORIZONTAL_TILES</code>x<code>BASE</code>
(= 671). Finally, for each <code>offset_x</code> we need to shift 1 pixel
down. All together this is</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let target_index = offset_Y * (BASE * HORIZONTAL_TILES * BASE) +
                   offset_X * BASE +
                   offset_y * (HORIZONTAL_TILES * BASE) +
                   offset_x
#}</code></pre></pre>
<p>With these calculations we know where to paint the image pixel.</p>
<a class="header" href="finding/collage.html#color" id="color"><h3>Color</h3></a>
<p>From our experience from creating an image we have a fairly good idea which
color to use. The only difference between the collage and the single image is
that we want to use the same scale for each image.</p>
<p>So instead of dividing our value by the maximum value of a single image, we
should divide by the global maximum.</p>
<p>Create a separate executable that will determine the global maximum of all the
measurements that we can use in determining the color of the pixel.</p>
<a class="header" href="finding/collage.html#further-considerations" id="further-considerations"><h2>Further Considerations</h2></a>
<p>The following suggestions might help your understanding of the problem we
facing, i.e. detecting planets in our image.</p>
<p>Take a long good look at your collage. Write down what you notice about the
image. Ask yourself some questions and discuss your observations with somebody
else.</p>
<p>Why do we need a global maximum? What would happen if we would stick to the
maximum per image? What would that look like, and what would it tell you?</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="finding/image.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="finding/brightness.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="finding/image.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="finding/brightness.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if (getComputedStyle(document.querySelector(".fa")).fontFamily !== "FontAwesome") {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = '_FontAwesome/css/font-awesome.css';
                document.head.insertBefore(link, document.head.firstChild)
            }
        </script>

        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
